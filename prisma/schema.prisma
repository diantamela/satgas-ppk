generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                  String                    @id @default(cuid())
  email               String                    @unique
  password            String
  name                String
  role                Role                      @default(USER)
  affiliation         Affiliation               @default(STUDENT)
  isActive            Boolean                   @default(true)
  createdAt           DateTime                  @default(now())
  updatedAt           DateTime                  @updatedAt
  uploadedDocuments   InvestigationDocument[]   @relation("UserDocuments")
  createdProcesses    InvestigationProcess[]    @relation("UserCreatedProcesses")
  teamMemberships     InvestigationTeamMember[]
  notifications       Notification[]
  reportsAsAssignee   Report[]                  @relation("ReportAssignee")
  reportsAsReporter   Report[]                  @relation("ReportReporter")
  timelineEntries     ReportTimeline[]          @relation("UserTimelineEntries")
  sessions            Session[]                 @relation("UserSessions")
  galleryItems        Gallery[]
  createdRecommendations    Recommendation[]     @relation("RecommendationCreatedBy")
  approvedRecommendations   Recommendation[]     @relation("RecommendationApprovedBy")

  @@index([email])
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  tokenHash String   @unique
  userAgent String?
  ip        String?
  expiresAt DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation("UserSessions", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expiresAt])
}



model Report {
  id                    String                  @id @default(cuid())
  reportNumber          String                  @unique
  title                 String
  description           String
  category              String?
  severity              String?
  incidentDate          DateTime?
  incidentLocation      String?
  status                ReportStatus            @default(PENDING)
  investigationProgress Int?                    @default(0)
  recommendationStatus  RecommendationStatus?   @default(PENDING)
  finalDecision         DecisionType?
  decisionNotes         String?
  reporterId            String
  reporterEmail         String?
  assigneeId            String?
  recommendation        String?
  evidenceCount         Int?                    @default(0)
  scheduledDate         DateTime?
  scheduledBy           String?
  scheduledNotes        String?
  createdAt             DateTime                @default(now())
  updatedAt             DateTime                @updatedAt
  documents             InvestigationDocument[]
  processes             InvestigationProcess[]
  assignee              User?                   @relation("ReportAssignee", fields: [assigneeId], references: [id])
  reporter              User                    @relation("ReportReporter", fields: [reporterId], references: [id])
  timelines             ReportTimeline[]
  activities            ReportActivity[]
  recommendations       Recommendation[]

  @@index([reporterId])
  @@index([assigneeId])
  @@index([status])
  @@index([createdAt])
  @@index([status, updatedAt])
  @@index([recommendationStatus])
}

model InvestigationProcess {
  id                   String                @id @default(cuid())
  reportId             String
  startDateTime        DateTime
  endDateTime          DateTime
  location             String
  methods              InvestigationMethod[]
  partiesInvolved      InvestigationParty[]
  otherPartiesDetails  String?
  consentObtained      Boolean               @default(false)
  consentDocumentation String?
  riskNotes            String?
  planSummary          String?
  followUpAction       String?
  followUpDate         DateTime?
  followUpNotes        String?
  status               ScheduleStatus        @default(SCHEDULED)
  accessLevel          AccessLevel           @default(CORE_TEAM_ONLY)
  createdById          String?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  createdBy            User?                 @relation("UserCreatedProcesses", fields: [createdById], references: [id])
  report               Report                @relation(fields: [reportId], references: [id], onDelete: Cascade)
  teamMembers          InvestigationTeamMember[]

  @@index([createdAt])
  @@index([reportId])
  @@index([status])
}

model InvestigationTeamMember {
  id         String   @id @default(cuid())
  processId  String
  userId     String
  role       TeamRole
  customRole String?
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  process    InvestigationProcess @relation(fields: [processId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([processId])
}



model InvestigationDocument {
  id           String       @id @default(cuid())
  reportId     String
  fileName     String
  fileType     String
  fileSize     Int
  storagePath  String
  documentType DocumentType
  uploadedById String?
  description  String?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  report       Report       @relation(fields: [reportId], references: [id], onDelete: Cascade)
  uploadedBy   User?        @relation("UserDocuments", fields: [uploadedById], references: [id])

  @@index([reportId])
  @@index([uploadedById])
}

model InvestigationResult {
  id                          String                 @id @default(dbgenerated("gen_random_uuid()"))
  processId                   String
  reportId                    String
  schedulingId                String?
  schedulingTitle             String?
  schedulingDateTime          DateTime?              @db.Timestamptz(6)
  schedulingLocation          String?
  caseTitle                   String?
  reportNumber                String?
  satgasMembersPresent        Json?
  partiesPresent              Json?
  identityVerified            Boolean?               @default(false)
  attendanceNotes             String?
  partiesStatementSummary     String?
  newPhysicalEvidence         String?
  evidenceFiles               Json?
  statementConsistency        String?
  sessionInterimConclusion    String?
  recommendedImmediateActions Json?
  caseStatusAfterResult       CaseStatusAfterResult? @default(UNDER_INVESTIGATION)
  statusChangeReason          String?
  dataVerificationConfirmed   Boolean?               @default(false)
  creatorDigitalSignature     String?
  creatorSignerName           String?
  creatorSignatureDate        DateTime?              @db.Timestamptz(6)
  chairpersonDigitalSignature String?
  chairpersonSignerName       String?
  chairpersonSignatureDate    DateTime?              @db.Timestamptz(6)
  partiesDetailedAttendance   Json?
  recommendedActionsDetails   Json?
  documentHash                String?
  internalSatgasNotes         String?
  createdAt                   DateTime?              @default(now()) @db.Timestamptz(6)
  updatedAt                   DateTime?              @default(now()) @updatedAt @db.Timestamptz(6)

  @@index([reportId])
  @@index([processId])
  @@index([createdAt])
  @@index([schedulingDateTime])
}

model Recommendation {
  id              String               @id @default(dbgenerated("gen_random_uuid()"))
  reportId        String
  title           String
  description     String
  content         String
  status          RecommendationStatus @default(PENDING)
  priority        Priority             @default(MEDIUM)
  createdById     String
  approvedById    String?
  approvedAt      DateTime?            @db.Timestamptz(6)
  rejectionReason String?
  createdAt       DateTime             @default(now()) @db.Timestamptz(6)
  updatedAt       DateTime             @default(now()) @updatedAt @db.Timestamptz(6)

  report       Report   @relation(fields: [reportId], references: [id], onDelete: Cascade)
  createdBy    User     @relation("RecommendationCreatedBy", fields: [createdById], references: [id])
  approvedBy   User?    @relation("RecommendationApprovedBy", fields: [approvedById], references: [id])

  @@index([reportId])
  @@index([status])
  @@index([createdById])
  @@index([createdAt])
}

model ReportTimeline {
  id        String       @id @default(cuid())
  reportId  String
  status    ReportStatus
  notes     String?
  userId    String?
  timestamp DateTime     @default(now())
  report    Report       @relation(fields: [reportId], references: [id], onDelete: Cascade)
  user      User?        @relation("UserTimelineEntries", fields: [userId], references: [id])

  @@index([reportId])
  @@index([userId])
  @@index([timestamp])
}

model ReportActivity {
  id                     String              @id @default(cuid())
  reportId               String
  activityType           ActivityType
  title                  String
  description            String
  status                 ActivityStatus      @default(IN_PROGRESS)
  assignedTo             String?
  priority               Priority            @default(MEDIUM)
  startedAt              DateTime            @default(now())
  estimatedCompletion    DateTime?
  completedAt            DateTime?
  isCurrent              Boolean             @default(true)
  notes                  String?
  createdAt              DateTime            @default(now())
  updatedAt              DateTime            @updatedAt
  report                 Report              @relation(fields: [reportId], references: [id], onDelete: Cascade)

  @@index([reportId])
  @@index([isCurrent])
  @@index([status])
  @@index([assignedTo])
  @@index([startedAt])
}

model Notification {
  id                String           @id @default(cuid())
  userId            String?
  type              NotificationType
  title             String
  message           String
  isRead            Boolean          @default(false)
  relatedEntityId   String?
  relatedEntityType String?
  createdAt         DateTime         @default(now())
  readAt            DateTime?
  updatedAt         DateTime         @updatedAt
  user              User?            @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([isRead])
  @@index([createdAt])
}
model Gallery {
  id          String   @id @default(cuid())
  title       String
  description String
  date        String
  location    String
  category    String
  image       String
  uploadedById String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  uploadedBy  User?    @relation(fields: [uploadedById], references: [id], onDelete: SetNull)

  @@index([uploadedById])
  @@index([createdAt])
}







model InvestigationActivity {
  id              String       @id
  reportId        String
  scheduleId      String?
  activityType    ActivityType
  title           String
  description     String
  location        String?
  startDateTime   DateTime
  endDateTime     DateTime?
  duration        Int?
  participants    String[]
  conductedById   String
  outcomes        String?
  challenges      String?
  recommendations String?
  isConfidential  Boolean      @default(false)
  accessLevel     AccessLevel  @default(CORE_TEAM_ONLY)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime

  @@index([activityType])
  @@index([conductedById])
  @@index([createdAt])
  @@index([reportId])
  @@index([scheduleId])
}



enum Role {
  USER
  SATGAS
  REKTOR
}

enum ReportStatus {
  PENDING
  VERIFIED
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  REJECTED
}

enum NotificationType {
  REPORT_STATUS_CHANGED
  REPORT_ASSIGNED
  NEW_RECOMMENDATION
  DECISION_MADE
  DOCUMENT_UPLOADED
  INVESTIGATION_SCHEDULED
  INVESTIGATION_ASSIGNMENT
  INVESTIGATION_SCHEDULE_UPDATED
  INVESTIGATION_CANCELLED
  INVESTIGATION_STATUS_UPDATE
  INFO
  WARNING
  SUCCESS
  ERROR
}

enum DocumentType {
  EVIDENCE
  INVESTIGATION_REPORT
  OFFICIAL_LETTER
  PROCEEDINGS
  RECOMMENDATION
}



enum DecisionType {
  APPROVED
  REJECTED
  FOLLOW_UP
}

enum RecommendationStatus {
  PENDING
  SUBMITTED
  APPROVED
  REJECTED
  IMPLEMENTED
}

enum Priority {
  LOW
  MEDIUM
  HIGH
}

enum Affiliation {
  STUDENT
  FACULTY
  STAFF
  GUEST
}

enum InvestigationMethod {
  INTERVIEW
  WRITTEN_CLARIFICATION
  LOCATION_OBSERVATION
  DIGITAL_EVIDENCE_COLLECTION
  MEDIATION
  OTHER
}

enum InvestigationParty {
  VICTIM_SURVIVOR
  REPORTED_PERSON
  WITNESS
  OTHER_PARTY
}

enum TeamRole {
  TEAM_LEADER
  NOTE_TAKER
  PSYCHOLOGICAL_SUPPORT
  LEGAL_SUPPORT
  INVESTIGATOR
  OTHER
}

enum ProcessStatus {
  PLANNED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum AccessLevel {
  CORE_TEAM_ONLY
  FULL_SATGAS
  LEADERSHIP_ONLY
}

enum InvestigationActivityType {
  VICTIM_INTERVIEW
  WITNESS_INTERVIEW
  REPORTED_PERSON_INTERVIEW
  EVIDENCE_COLLECTION
  LOCATION_OBSERVATION
  MEDIATION_SESSION
  CONFRONTATION
  FOLLOW_UP_INTERVIEW
  CASE_REVIEW
  OTHER
}

enum EquipmentItem {
  CAMERA_RECORDER
  AUDIO_RECORDER
  PRINTED_FORMS
  PROJECTOR_SCREEN
  COMPUTER_LAPTOP
  PRINTER
  NOTARY_PRESENCE
  LEGAL_COUNSEL
  PSYCHOLOGICAL_SUPPORT
  TRANSLATOR
  SECURITY_PERSONNEL
  VIDEO_CONFERENCE_SETUP
}

enum CompanionRequirement {
  PSYCHOLOGIST
  COUNSELOR
  LEGAL_ADVISOR
  RELIGIOUS_COUNSELOR
  FAMILY_MEMBER
  FRIEND_SUPPORT
  ADVOCATE
  NONE
}

enum CaseStatusAfterResult {
  UNDER_INVESTIGATION
  EVIDENCE_COLLECTION
  STATEMENT_ANALYSIS
  PENDING_EXTERNAL_INPUT
  READY_FOR_RECOMMENDATION
  CLOSED_TERMINATED
  FORWARDED_TO_REKTORAT
}

enum ActivityType {
  INTERVIEW_CONDUCTED
  EVIDENCE_COLLECTED
  SITE_VISIT
  DOCUMENT_REVIEW
  WITNESS_STATEMENT
  MEDIATION_SESSION
  FOLLOW_UP_ACTION
  OTHER_ACTIVITY
}

enum RecommendedAction {
  SCHEDULE_NEXT_SESSION
  CALL_OTHER_PARTY
  REQUIRE_PSYCHOLOGICAL_SUPPORT
  REQUIRE_LEGAL_SUPPORT
  CASE_TERMINATED
  FORWARD_TO_REKTORAT
  MEDIATION_SESSION
  EVIDENCE_ANALYSIS
  WITNESS_REINTERVIEW
  OTHER
}

enum ScheduleStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  RESCHEDULED
}

enum ActivityStatus {
  NOT_STARTED
  IN_PROGRESS
  PAUSED
  COMPLETED
  CANCELLED
}
